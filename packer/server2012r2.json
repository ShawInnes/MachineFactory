{
  "variables": {
    "vmname": "server2012r2_20150725.1"
  },

  "builders": [{
    "type": "vmware-windows-iso",
    "vm_name": "{{user `vmname`}}",
    "iso_url": "../../ISO/en_windows_server_2012_r2_with_update_x64_dvd_4065220.iso",
    "iso_checksum": "af6a7f966b4c4e31da5bc3cdc3afcbec",
    "iso_checksum_type": "md5",
    "guest_os_type": "windows8srv-64",
    "headless": false,
    "boot_wait": "3m",
    "winrm_username": "packer",
    "winrm_password": "packer",
    "winrm_wait_timeout": "10m",
    "shutdown_timeout": "1h",
    "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
    "disk_size": 50000,
    "floppy_files": [
      "windows_2012_r2/Autounattend.xml",
      "scripts/init.bat",
      "scripts/enable-winrm.bat"
    ],
    "vmdk_name": "{{user `vmname`}}",
    "vmx_data": {
      "memsize": "2048",
      "numvcpus": "2",
      "scsi0.virtualDev": "lsisas1068"
    }
  }],
  "provisioners": [
  {
    "type":"powershell",
    "inline": [
      "New-Item \\Tools -Type Directory"
    ]
  },
  {
    "type": "file",
    "source": "tools/VMware-tools-9.4.12-2627939-x86_64.exe",
    "destination": "\\Tools\\vmware-tools-x86_64.exe"
  },
  {
    "type": "file",
    "source": "tools/chef-windows-11.18.6-1.windows.msi",
    "destination": "\\Tools\\chef-windows.msi"
  },
  {
    "type":"powershell",
    "scripts": [
      "scripts/vmware-tools.ps1"
    ]
  },
  {
    "pause_before":"3m",
    "type":"powershell",
    "scripts": [
      "scripts/chef-windows.ps1"
    ]
  },
  {
    "type":"powershell",
    "scripts": [
      "scripts/chocolatey.ps1"
    ]
  }
  ],
  "post-processors": [
  {
    "type": "vagrant",
    "output": "../boxes/{{user `vmname`}}.box"
  },
  {
    "type": "vsphere",
    "disk_mode": "thin",
    "cluster": "ClusterBuster",
    "datacenter": "MacBook",
    "datastore": "datastore1",
    "resource_pool": "defaultpool",
    "host": "10.0.0.128",
    "password": "vmware",
    "username": "root",
    "vm_folder": "templates",
    "vm_name": "{{user `vmname`}}",
    "insecure": true
  }
  ]
}
