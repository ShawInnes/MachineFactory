{
  "variables": {
    "edition": "2012r2",
    "vmname": "server2012r2",
    "chefwindows": "chef-windows.msi"
  },
  "builders": [{
    "type": "vmware-iso",
    "vm_name": "{{user `vmname`}}",
    "iso_url": "../../ISO/en_windows_server_2012_r2_with_update_x64_dvd_4065220.iso",
    "iso_checksum": "af6a7f966b4c4e31da5bc3cdc3afcbec",
    "iso_checksum_type": "md5",
    "guest_os_type": "windows8srv-64",
    "headless": false,
    "boot_wait": "3m",
    "communicator": "winrm",
    "winrm_username": "packer",
    "winrm_password": "packer",
    "shutdown_timeout": "1h",
    "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
    "disk_size": 50000,
    "floppy_files": [
      "answer_files/{{user `edition`}}/Autounattend.xml",
      "scripts/init.bat",
      "scripts/fixnetwork.ps1",
      "scripts/enable-winrm.bat"
    ],
    "vmdk_name": "{{user `vmname`}}",
    "vmx_data": {
      "memsize": "2048",
      "numvcpus": "2",
      "scsi0.virtualDev": "lsisas1068"
    }
  }],
  "provisioners": [
  {
    "type":"powershell",
    "inline": [ "New-Item \\Tools -Type Directory" ],
    "except": ["vmware-iso"]
  },
  {
    "type": "file",
    "source": "tools/{{user `vmwaretools`}}",
    "destination": "\\Tools\\vmware-tools-x86_64.exe",
    "except": ["vmware-iso"]
  },
  {
    "type": "file",
    "source": "tools/{{user `chefwindows`}}",
    "destination": "\\Tools\\chef-windows.msi",
    "except": ["vmware-iso"]
  },
  {
    "type":"powershell",
    "scripts": [ "scripts/vmware-tools.ps1" ],
    "except": ["vmware-iso"]
  },
  {
    "pause_before":"3m",
    "type":"powershell",
    "scripts": [ "scripts/chef-windows.ps1" ],
    "except": ["vmware-iso"]
  },
  {
    "type":"powershell",
    "scripts": [ "scripts/chocolatey.ps1" ],
    "except": ["vmware-iso"]
  }
  ],
  "post-processors": [
  {
    "type": "vagrant",
    "output": "../boxes/{{user `vmname`}}.box",
    "vagrantfile_template": "server2012r2_vagrantfile.template"
  }
  ]
}
